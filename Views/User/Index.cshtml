@model IEnumerable<Cucina_De_Corazon.Models.Account>

@{
    ViewData["Title"] = "User Management";
}

<div class="container mt-5">
    <div class="card shadow border-0 rounded-4 p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-orange mb-0">User Management</h3>
            <a href="/User/CreateStaff" class="btn btn-orange fw-bold px-3 rounded-3">
                + Add Staff
            </a>
        </div>

        @if (!Model.Any())
        {
            <div class="alert alert-info text-center rounded-3">No users found.</div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-striped align-middle rounded-3">
                    <thead class="table-warning">
                        <tr>
                            <th>#</th>
                            <th>Full Name</th>
                            <th>Username</th>
                            <th>Role</th>
                            <th>Email</th>
                            <th>Date Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model)
                        {
                            <tr>
                                <td>@user.AccountId</td>
                                <td>@user.Person?.FullName</td>
                                <td>@user.Username</td>
                                <td>
                                    <span class="badge bg-@(user.Role == "Admin" ? "danger" : user.Role == "Staff" ? "warning text-dark" : "secondary")">
                                        @user.Role
                                    </span>
                                </td>
                                <td>@user.Person?.Email</td>
                                <td>@user.CreatedAt.ToString("MMM dd, yyyy")</td>
                                <td>
                                    <form method="post" action="/User/Delete" class="d-inline delete-user-form">
                                        <input type="hidden" name="id" value="@user.AccountId" />
                                        <button type="submit" class="btn btn-sm btn-danger fw-bold rounded-2">
                                            Remove
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        document.querySelectorAll(".delete-user-form").forEach(form => {
            form.addEventListener("submit", async e => {
                e.preventDefault();
                if (!confirm("Are you sure you want to delete this user?")) return;

                const formData = new FormData(form);
                try {
                    const res = await fetch(form.action, {
                        method: "POST",
                        body: formData
                    });
                    const data = await res.json();

                    if (data.success) {
                        alert("✅ " + data.message);
                        location.reload();
                    } else {
                        alert("⚠️ " + data.message);
                    }
                } catch (err) {
                    console.error(err);
                    alert("❌ Something went wrong.");
                }
            });
        });
    </script>

    <style>
        .text-orange {
            color: #f57c1f;
        }

        .btn-orange {
            background-color: #f57c1f;
            color: white;
            border: none;
            transition: 0.2s;
        }

            .btn-orange:hover {
                background-color: #e36e14;
            }
    </style>
}
