@model List<Cucina_De_Corazon.Models.Product>
@{
    ViewData["Title"] = "Products";
}

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Products</h2>
        <a asp-action="Create" class="btn btn-warning text-white fw-bold" style="background: #f57c1f;">Add Product</a>
    </div>

    <table class="table table-striped table-bordered">
        <thead class="table-warning">
            <tr>
                <th>Picture</th>
                <th>Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Category</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var p in Model)
            {
                <tr>
                    <td>
                        @if (p.ProductPicture != null)
                        {
                            <img src="~/images/@p.ProductPicture" style="height:60px; object-fit:cover;" class="rounded" />
                        }
                    </td>
                    <td>@p.ProductName</td>
                    <td>@p.ProductDescription</td>
                    <td>₱@p.ProductPrice</td>
                    <td>@p.Category?.CategoryName</td>
                    <td>
                        <a asp-action="Edit" asp-route-id="@p.ProductId" class="btn btn-sm btn-primary">Edit</a>
                        <a asp-action="Details" asp-route-id="@p.ProductId" class="btn btn-sm btn-info text-white">Details</a>
                        <button class="btn btn-sm btn-danger delete-btn" data-id="@p.ProductId">Delete</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
@section Scripts {
    <script>
        document.querySelectorAll(".delete-btn").forEach(btn => {
            btn.addEventListener("click", async (e) => {
                e.preventDefault();
                const id = btn.getAttribute("data-id");
                if (!confirm("Are you sure you want to delete this product?")) return;

                try {
                    const response = await fetch(`/Menu/Delete/${id}`, {
                        method: "POST"
                    });
                    const data = await response.json();
                    if (data.success) {
                        alert("✅ Product deleted successfully!");
                        location.reload();
                    } else {
                        alert("⚠️ " + data.message);
                    }
                } catch (err) {
                    console.error(err);
                    alert("❌ Something went wrong.");
                }
            });
        });
    </script>
}

